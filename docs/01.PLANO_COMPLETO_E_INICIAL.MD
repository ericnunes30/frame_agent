============================================
 PLANO: Construtor de Agentes Simples (TS + BAML)
============================================

ğŸ¯ OBJETIVO:
Criar um construtor de agentes em TypeScript que utilize a biblioteca BAML para:
- ConexÃ£o com LLMs (OpenAI, etc.)
- Montagem de prompts
- ValidaÃ§Ã£o/formatagem de saÃ­das
Nosso cÃ³digo cuidarÃ¡ do resto: estado, ciclo de execuÃ§Ã£o, tools, orquestraÃ§Ã£o.

ğŸ§­ ETAPAS DE PLANEJAMENTO:

1. ESCOPO DO AGENTE

âœ… MVP (MÃ­nimo ViÃ¡vel):
   - System prompt inicial
   - Input do usuÃ¡rio â†’ chamada BAML â†’ resposta
   - HistÃ³rico de mensagens (contexto linear)

âœ… PRÃ“XIMO NÃVEL:
   - Suporte a tools/funÃ§Ãµes
   - MemÃ³ria de contexto (curto prazo)
   - ConfiguraÃ§Ã£o dinÃ¢mica (modelo, temperatura, etc.)
   - ValidaÃ§Ã£o de saÃ­da via schema (BAML)
   - Modo streaming (se suportado)

âœ… FUTURO (opcional):
   - Agentes multi-passos (plan+execute)
   - PersistÃªncia de estado
   - IntegraÃ§Ã£o com vector stores
   - Config via JSON/YAML

2. ARQUITETURA DO CONSTRUTOR

ğŸ”¹ Componentes principais:
   - ConfiguraÃ§Ã£o do agente (instruÃ§Ãµes, modelo, tools, schema)
   - Gerenciamento de estado (histÃ³rico, variÃ¡veis de contexto)
   - Ciclo de execuÃ§Ã£o (input â†’ BAML â†’ resposta/tool â†’ loop â†’ output)
   - IntegraÃ§Ã£o com tools (execuÃ§Ã£o + reinserÃ§Ã£o no contexto)
   - Tratamento de erros e validaÃ§Ã£o

3. INTERFACE DE USO (API)

Exemplo desejado:
   const agente = construtor({
     nome: "Financeiro",
     instrucoes: "...",
     modelo: "gpt-4",
     tools: [tool1, tool2],
     schemaSaida: z.object(...)
   });

   const resposta = await agente.perguntar("...");

MÃ©todos pÃºblicos esperados:
   - .perguntar(input: string) â†’ Promise<string|object>
   - .resetar() â†’ void
   - .obterContexto() â†’ histÃ³rico

Stateful: mantÃ©m memÃ³ria entre chamadas.

4. INTEGRAÃ‡ÃƒO COM BAML

Mapear:
   - Assinatura da chamada principal da BAML
   - Estrutura de retorno (texto? tool_calls? tokens?)
   - Suporte a function calling
   - Suporte a schemas de saÃ­da (Zod? JSON Schema?)
   - Suporte a streaming

Isso definirÃ¡:
   - Como montar o payload de chamada
   - Como tratar tool_calls no ciclo
   - Como validar/parsear a resposta final

5. FLUXO DE EXECUÃ‡ÃƒO (com tools)

1. UsuÃ¡rio envia pergunta
2. Adiciona ao histÃ³rico como mensagem "user"
3. Chama BAML com histÃ³rico + tools
4. Se BAML retorna tool_calls:
   â†’ Executa cada tool
   â†’ Adiciona resultado como mensagem "tool"
   â†’ Volta ao passo 3
5. Se BAML retorna resposta final:
   â†’ Adiciona como "assistant"
   â†’ Retorna ao usuÃ¡rio

6. EXTENSIBILIDADE

Facilitar:
   - AdiÃ§Ã£o de novas tools (interface padrÃ£o: {name, description, execute})
   - CriaÃ§Ã£o de "templates" de agentes (ex: Agente de Suporte, Analista de Dados)
   - Troca de provedor/modelo via config
   - Schemas de saÃ­da customizÃ¡veis

7. TESTES E VALIDAÃ‡ÃƒO

âœ… UnitÃ¡rios:
   - CriaÃ§Ã£o do agente (config vÃ¡lida/invÃ¡lida)
   - Chamada sem tools
   - Chamada com tool mockada
   - ValidaÃ§Ã£o de schema

âœ… IntegraÃ§Ã£o:
   - Chamada real Ã  BAML (sandbox)
   - Fluxo completo com 1+ tools

âœ… Borda:
   - Resposta muito longa
   - Tool falha
   - Parsing invÃ¡lido
   - Modelo indisponÃ­vel

8. DOCUMENTAÃ‡ÃƒO

Incluir:
   - Como instanciar um agente
   - Como criar/adicionar tools
   - Como definir schemas de saÃ­da
   - Exemplos de uso comuns

ğŸ—ºï¸ MAPA MENTAL RESUMIDO:

Construtor de Agentes (TypeScript)
â”‚
â”œâ”€â”€ Entrada: ConfiguraÃ§Ã£o (instruÃ§Ãµes, modelo, tools, schema)
â”œâ”€â”€ SaÃ­da: InstÃ¢ncia de Agente
â”‚
â”œâ”€â”€ Agente:
â”‚   â”œâ”€â”€ Estado: HistÃ³rico + variÃ¡veis
â”‚   â”œâ”€â”€ MÃ©todo: .perguntar(input) â†’ resposta
â”‚   â”œâ”€â”€ MÃ©todo: .resetar()
â”‚   â””â”€â”€ MÃ©todo: .obterContexto()
â”‚
â”œâ”€â”€ Ciclo:
â”‚   input â†’ contexto â†’ BAML â†’ resposta/tool â†’ executa tool â†’ BAML â†’ ... â†’ resposta final
â”‚
â”œâ”€â”€ IntegraÃ§Ã£o com BAML:
â”‚   - Chamada com mensagens, tools, schema
â”‚   - Tratamento de tool_calls
â”‚   - ValidaÃ§Ã£o de saÃ­das
â”‚
â”œâ”€â”€ ExtensÃ­vel:
â”‚   - Novas tools
â”‚   - Novos agentes
â”‚   - Novos schemas
â”‚
â””â”€â”€ Testes:
    - UnitÃ¡rios
    - IntegraÃ§Ã£o
    - Borda

âœ… PRÃ“XIMOS PASSOS:

1. Revisar documentaÃ§Ã£o da BAML â†’ entender limites e capacidades
2. Definir MVP exato â†’ qual primeiro agente funcional?
3. Desenhar fluxo de execuÃ§Ã£o â†’ diagrama ou texto sequencial
4. Listar 2-3 tools iniciais â†’ foco em utilidade imediata
5. Definir 1-2 schemas de saÃ­da â†’ estruturados para validaÃ§Ã£o